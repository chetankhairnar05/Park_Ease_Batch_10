<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Park Ease - Official Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .fade-in {
        animation: fadeIn 0.3s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body class="bg-gray-900 flex items-center justify-center min-h-screen p-4">
    <div
      class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden fade-in"
    >
      <div class="bg-indigo-900 p-8 text-center">
        <div
          class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-indigo-700 mb-4 text-white"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
            />
          </svg>
        </div>
        <h1 class="text-3xl font-bold text-white tracking-tight">
          Partner Access
        </h1>
        <p class="text-indigo-200 mt-2 text-sm">
          Register as Admin or Area Owner
        </p>
      </div>

      <div class="p-8">
        <div
          id="alert-box"
          class="hidden mb-4 p-3 rounded text-sm text-center"
        ></div>

        <form
          id="register-form"
          onsubmit="handleOfficialRegister(event)"
          class="space-y-4"
        >
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Select Role</label
            >
            <div class="relative">
              <select
                id="reg-role"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none appearance-none bg-white"
                required
              >
                <option value="" disabled selected>Choose your role...</option>
                <option value="AREA_OWNER">üè¢ Area Owner</option>
                <option value="ADMIN">‚ö° Admin</option>
              </select>
              <div
                class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"
              >
                <svg
                  class="fill-current h-4 w-4"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"
                  />
                </svg>
              </div>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Full Name</label
            >
            <input
              type="text"
              id="reg-name"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
              placeholder="Official Name"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Email Address</label
            >
            <input
              type="email"
              id="reg-email"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
              placeholder="official@parkease.com"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Phone Number</label
            >
            <input
              type="tel"
              id="reg-phone"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
              placeholder="9876543210"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Password</label
            >
            <input
              type="password"
              id="reg-password"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
              placeholder="Create a strong password"
              required
            />
          </div>

          <button
            type="submit"
            class="w-full bg-indigo-900 hover:bg-indigo-800 text-white font-bold py-3 rounded-lg shadow-lg transition transform active:scale-95 mt-4"
          >
            Register Official Account
          </button>
        </form>
      </div>

      <div class="bg-gray-50 px-8 py-4 border-t border-gray-100 text-center">
        <a
          href="auth.html"
          class="text-sm text-indigo-600 hover:text-indigo-800 font-medium"
        >
          &larr; Back to User Login
        </a>
      </div>
    </div>

    <script>
      const API_BASE_URL = "http://localhost:8080/api/auth";

      function showAlert(message, type) {
        const alertBox = document.getElementById("alert-box");
        alertBox.classList.remove(
          "hidden",
          "bg-red-100",
          "text-red-700",
          "bg-green-100",
          "text-green-700"
        );

        if (type === "error") {
          alertBox.classList.add("bg-red-100", "text-red-700");
        } else {
          alertBox.classList.add("bg-green-100", "text-green-700");
        }
        alertBox.innerText = message;
      }

      async function handleOfficialRegister(event) {
        event.preventDefault();

        // Gather Data
        const role = document.getElementById("reg-role").value;
        const name = document.getElementById("reg-name").value;
        const email = document.getElementById("reg-email").value;
        const phone = document.getElementById("reg-phone").value;
        const password = document.getElementById("reg-password").value;

        if (!role) {
          showAlert("Please select a role.", "error");
          return;
        }

        try {
          // Changed endpoint to /register-official
          const response = await fetch(`${API_BASE_URL}/register-official`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            // Included role in the body
            body: JSON.stringify({ name, email, phone, password, role }),
          });

          const text = await response.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch {
            data = { message: text };
          }

          if (response.ok) {
            showAlert(
              "Official Account Created! Redirecting to login...",
              "success"
            );
            document.getElementById("register-form").reset();

            // Redirect back to main login page after 2 seconds
            setTimeout(() => {
              window.location.href = "auth.html";
            }, 2000);
          } else {
            showAlert(
              data.message || data.error || "Registration Failed",
              "error"
            );
          }
        } catch (error) {
          console.error("Error:", error);
          showAlert("Server connection failed.", "error");
        }
      }
    </script>
  </body>
</html>
